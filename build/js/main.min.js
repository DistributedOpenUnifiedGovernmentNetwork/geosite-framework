var init_main=function(t,i){var n=angular.module(t,[]);$(".site-controller").each(function(){var t=$(this),e=t.data("siteControllerName"),r=t.data("siteControllerType");if("data"==r.toLowerCase()){var o=t.data("siteControllerUrl"),a=t.data("siteControllerRegionFilter"),d=void 0;void 0!==a&&a.length>0&&(d=a.split(";"));var l=t.data("siteControllerRegionName");init_controller_data(n,t,e,i,d,l,o)}}),angular.bootstrap(document,[t])},init_controller_data=function(t,i,n,e,r,o,a){t.controller(n,function(t,i){t.datasets=[],$.ajax({dataType:"xml",url:a,success:function(i){t.datasets=parseCSW(i,e,r,o),$("#tab-data a span.count").html(" ("+t.datasets.length+")"),t.$apply()}})})},buildBoundingBox=function(t){var i=[0,0,0,0];try{i=[parseFloat(parseFloat(t.find("westBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("southBoundLatitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("eastBoundLongitude").text().trim()).toFixed(4)),parseFloat(parseFloat(t.find("northBoundLatitude").text().trim()).toFixed(4))]}catch(n){i=[0,0,0,0]}return i},ellipsis=function(t,i){return-1==i?t:t.length>i?t.substring(0,i-3)+"...":t},sortLayers=function(t){return t.sort(function(t,i){return t.options.zIndex-i.options.zIndex})},updateRenderOrder=function(t){for(var i=0;i<t.length;i++)t[i].bringToFront()},formatDate=function(t){return void 0!==t?t.getFullYear()+"-"+(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate()):""},parseCSW=function(t,i,n,e){var r=[];return $(t).find("SearchResults").find("MD_Metadata").each(function(){var t=$(this),o=t.find("identificationInfo").find("MD_DataIdentification"),a=t.find("distributionInfo").find("MD_Distribution"),d=o.find("EX_GeographicBoundingBox:first"),l=a.find("onLine").filter(function(){return"WWW:LINK-1.0-http--link"==$(this).find("protocol").find("CharacterString").text()}).find("URL").text().trim();if(l.startsWith(i)&&d.length>0){var f=o.find("title").find("CharacterString").text(),s=o.find("date").find("DateTime").text(),u=o.find("graphicOverview").find("fileName").text().trim(),c=ellipsis(o.find("abstract").find("CharacterString").text().replace("\n",""),200),h=o.find("descriptiveKeywords").filter(function(){return"place"==$(this).find("type").text().trim()}).find("keyword").map(function(){return $(this).text().trim()}).get(),p=a.find("onLine").filter(function(){return"WWW:DOWNLOAD-1.0-http--download"==$(this).find("protocol").text().trim()}).filter(function(){return $(this).find("name").text().trim().endsWith(".zip")}).find("URL").text().trim(),m=a.find("onLine").filter(function(){return"WWW:DOWNLOAD-1.0-http--download"==$(this).find("protocol").text().trim()}).filter(function(){return $(this).find("name").text().trim().endsWith(".json")}).find("URL").text().trim(),g=a.find("onLine").filter(function(){return"WWW:DOWNLOAD-1.0-http--download"==$(this).find("protocol").text().trim()}).filter(function(){return $(this).find("description").text().trim().endsWith("(KML Format)")}).find("URL").text().trim(),x={title:f,date_published:formatDate(new Date(Date.parse(s))),region:e,"abstract":c,url_detail:l,url_shapefile:p,url_geojson:m,url_kml:g,url_region:"",url_thumbnail_200x150:u};void 0!==n?$(h).filter(n).length>0&&r.push(x):r.push(x)}}),r};